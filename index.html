<!DOCTYPE html>
<html lang="pt-PT">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MBA ‚Äî Mythology Basketball Ascension</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800&family=Playfair+Display:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üèõÔ∏è</text></svg>">
</head>
<body>
    <!-- Loading Screen -->
    <div id="loading-screen" class="loading-screen">
        <div class="loading-content">
            <div class="spiral-animation">
                <div class="spiral"></div>
                <div class="spiral"></div>
                <div class="spiral"></div>
            </div>
            <div class="loading-text">
                <h1 class="loading-title">MYTHOLOGY BASKETBALL ASCENSION</h1>
                <p class="loading-subtitle">Inicializando cosmos mitol√≥gico...</p>
                <div class="loading-progress">
                    <div class="progress-bar">
                        <div id="progress-fill" class="progress-fill"></div>
                    </div>
                    <div id="loading-progress" class="progress-text">0%</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main App (hidden initially) -->
    <div id="app" class="app-container hidden">
        <!-- Header -->
        <header class="app-header">
            <div class="header-left">
                <div class="logo-container">
                    <div class="logo-symbol">‚çü</div>
                    <div class="logo-text">
                        <h1 class="logo-title">MBA</h1>
                        <p class="logo-subtitle">Mythology Basketball Ascension</p>
                    </div>
                </div>
                
                <div class="season-info">
                    <div class="season-phase" id="season-phase">
                        <span class="phase-badge">√âPOCA REGULAR</span>
                    </div>
                    <div class="season-day">
                        <span class="day-label">DIA</span>
                        <span class="day-number" id="day-number">1/82</span>
                    </div>
                </div>
            </div>

            <div class="header-center">
                <div class="user-team-info" id="user-team-info">
                    <div class="team-logo-large">üèõÔ∏è</div>
                    <div class="team-details">
                        <h2 class="team-name">OLIMPO TITANS</h2>
                        <div class="team-stats-row">
                            <span class="team-stat"><i class="fas fa-trophy"></i> REP: 50</span>
                            <span class="team-stat"><i class="fas fa-basketball-ball"></i> PODER: 78</span>
                            <span class="team-stat"><i class="fas fa-chart-line"></i> 0-0</span>
                            <span class="team-stat"><i class="fas fa-fire"></i> STREAK: 0</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="header-right">
                <div class="simulation-controls">
                    <div class="speed-controls">
                        <button class="btn-control speed-btn active" data-speed="1" title="Velocidade 1x">
                            <i class="fas fa-tachometer-alt"></i> 1x
                        </button>
                        <button class="btn-control speed-btn" data-speed="2" title="Velocidade 2x">
                            2x
                        </button>
                        <button class="btn-control speed-btn" data-speed="5" title="Velocidade 5x">
                            5x
                        </button>
                        <button class="btn-control speed-btn" data-speed="10" title="Velocidade 10x">
                            10x
                        </button>
                    </div>
                    
                    <div class="play-controls">
                        <button id="btn-play-pause" class="btn-control btn-play" title="Iniciar/Pausar simula√ß√£o">
                            <i class="fas fa-play"></i> <span>INICIAR</span>
                        </button>
                        <button id="btn-simulate-day" class="btn-control btn-secondary" title="Simular pr√≥ximo dia">
                            <i class="fas fa-forward"></i> <span>SIMULAR DIA</span>
                        </button>
                        <button id="btn-auto-toggle" class="btn-control btn-auto active" title="Alternar modo autom√°tico">
                            <i class="fas fa-robot"></i> <span>AUTO</span>
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content (3 Columns) -->
        <main class="app-main">
            <!-- Left Column: Navigation & Consoles -->
            <div class="column left-column">
                <section class="console-panel">
                    <div class="panel-header">
                        <h3><i class="fas fa-compass"></i> NAVE√á√ÉO</h3>
                    </div>
                    <nav class="console-nav">
                        <button class="nav-btn active" data-view="dashboard">
                            <i class="fas fa-tachometer-alt"></i> Dashboard
                        </button>
                        <button class="nav-btn" data-view="teams" id="btn-team-select">
                            <i class="fas fa-users"></i> Equipas
                        </button>
                        <button class="nav-btn" data-view="roster" id="btn-view-roster">
                            <i class="fas fa-user-friends"></i> Plantel
                        </button>
                        <button class="nav-btn" data-view="schedule">
                            <i class="fas fa-calendar-alt"></i> Calend√°rio
                        </button>
                        <button class="nav-btn" data-view="transactions">
                            <i class="fas fa-exchange-alt"></i> Transa√ß√µes
                        </button>
                        <button class="nav-btn" data-view="finances" id="btn-cap-info">
                            <i class="fas fa-coins"></i> Finan√ßas
                        </button>
                        <button class="nav-btn" data-view="history" id="btn-view-history">
                            <i class="fas fa-history"></i> Hist√≥rico
                        </button>
                    </nav>
                </section>

                <section class="console-panel">
                    <div class="panel-header">
                        <h3><i class="fas fa-filter"></i> FILTROS</h3>
                    </div>
                    <div class="filter-controls">
                        <div class="filter-group">
                            <label for="filter-conference">Confer√™ncia:</label>
                            <select id="filter-conference" class="filter-select">
                                <option value="all">Todas</option>
                                <option value="EAST">Este</option>
                                <option value="WEST">Oeste</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label for="filter-phase">Fase:</label>
                            <select id="filter-phase" class="filter-select">
                                <option value="all">Todas</option>
                                <option value="regular">√âpoca Regular</option>
                                <option value="playoffs">Playoffs</option>
                            </select>
                        </div>
                        <button id="btn-refresh-standings" class="btn-control btn-small">
                            <i class="fas fa-sync-alt"></i> Atualizar
                        </button>
                    </div>
                </section>

                <section class="console-panel">
                    <div class="panel-header">
                        <h3><i class="fas fa-terminal"></i> CONSOLA</h3>
                    </div>
                    <div class="console-output" id="status-text">
                        <div class="console-entry info">
                            <span class="console-time">[12:00:00]</span>
                            <span>üèÄ Bem-vindo ao MBA!</span>
                        </div>
                        <div class="console-entry success">
                            <span class="console-time">[12:00:01]</span>
                            <span>‚úÖ Sistema inicializado com sucesso</span>
                        </div>
                    </div>
                </section>
            </div>

            <!-- Center Column: Main Content -->
            <div class="column center-column">
                <section class="content-panel standings-panel">
                    <div class="panel-header">
                        <h3><i class="fas fa-trophy"></i> CLASSIFICA√á√ïES</h3>
                        <div class="conference-tabs">
                            <button class="conf-tab active" data-conference="EAST">CONFER√äNCIA ESTE</button>
                            <button class="conf-tab" data-conference="WEST">CONFER√äNCIA OESTE</button>
                        </div>
                    </div>
                    <div class="standings-container">
                        <div id="standings-east" class="standings-conference active">
                            <!-- East standings will be populated by JS -->
                            <div class="loading-standings">
                                <div class="spiral-small"></div>
                                <p>Carregando classifica√ß√µes...</p>
                            </div>
                        </div>
                        <div id="standings-west" class="standings-conference">
                            <!-- West standings will be populated by JS -->
                            <div class="loading-standings">
                                <div class="spiral-small"></div>
                                <p>Carregando classifica√ß√µes...</p>
                            </div>
                        </div>
                    </div>
                </section>

                <section class="content-panel games-panel">
                    <div class="panel-header">
                        <h3><i class="fas fa-broadcast-tower"></i> JOGOS EM DIRETO</h3>
                        <button id="btn-simulate-next" class="btn-control btn-small">
                            <i class="fas fa-play-circle"></i> Simular Jogo
                        </button>
                    </div>
                    <div class="games-container" id="recent-games">
                        <!-- Live games will be populated by JS -->
                        <div class="no-games">
                            <i class="fas fa-basketball-ball"></i>
                            <p>Aguardando in√≠cio da temporada...</p>
                        </div>
                    </div>
                </section>
            </div>

            <!-- Right Column: Side Panels -->
            <div class="column right-column">
                <section class="side-panel">
                    <div class="panel-header">
                        <h3><i class="fas fa-arrow-right"></i> PR√ìXIMOS JOGOS</h3>
                    </div>
                    <div class="upcoming-games" id="upcoming-games">
                        <!-- Upcoming games will be populated by JS -->
                        <div class="no-upcoming">
                            <i class="fas fa-calendar-plus"></i>
                            <p>Sem jogos agendados</p>
                        </div>
                    </div>
                </section>

                <section class="side-panel">
                    <div class="panel-header">
                        <h3><i class="fas fa-rss"></i> FEED EM DIRETO</h3>
                    </div>
                    <div class="live-feed" id="live-feed">
                        <!-- Live feed will be populated by JS -->
                        <div class="feed-entry">
                            <span class="feed-time">Q1 12:00</span>
                            <span>üèÄ In√≠cio do jogo!</span>
                        </div>
                    </div>
                </section>

                <section class="side-panel roster-panel" id="team-roster-preview">
                    <div class="panel-header">
                        <h3><i class="fas fa-user-friends"></i> PLANTEL RESUMO</h3>
                    </div>
                    <div class="roster-summary">
                        <!-- Team roster preview will be populated by JS -->
                        <div class="empty-roster">
                            <i class="fas fa-users"></i>
                            <p>Selecione uma equipa</p>
                        </div>
                    </div>
                </section>

                <section class="side-panel" id="job-offers-section" style="display: none;">
                    <div class="panel-header">
                        <h3><i class="fas fa-briefcase"></i> OFERTAS DE EMPREGO</h3>
                    </div>
                    <div class="job-offers" id="job-offers">
                        <!-- Job offers will be populated by JS -->
                    </div>
                </section>
            </div>
        </main>

        <!-- Footer -->
        <footer class="app-footer">
            <div class="footer-left">
                <div class="system-status">
                    <span class="status-indicator online"></span>
                    <span class="status-text" id="status-text-footer">Sistema online ‚Ä¢ NBA Season 2026</span>
                </div>
            </div>
            
            <div class="footer-center">
                <div class="game-controls-footer">
                    <button id="btn-switch-team" class="btn-footer">
                        <i class="fas fa-exchange-alt"></i> MUDAR EQUIPA
                    </button>
                    <button class="btn-footer" id="btn-open-settings">
                        <i class="fas fa-cog"></i> CONFIGURA√á√ïES
                    </button>
                    <button class="btn-footer" id="btn-help">
                        <i class="fas fa-question-circle"></i> AJUDA
                    </button>
                </div>
            </div>
            
            <div class="footer-right">
                <div class="version-info">
                    <span class="version">v2.0.0</span>
                    <span class="copyright">¬© 2026 MBA ‚Äî Hilma af Klint Edition</span>
                </div>
            </div>
        </footer>
    </div>

    <!-- Modal System -->
    <div class="modal-overlay" id="modal-overlay"></div>

    <!-- Team Selection Modal -->
    <div class="modal" id="team-selection-modal">
        <div class="modal-header">
            <h3><i class="fas fa-crown"></i> SELECIONE SUA EQUIPA MITOL√ìGICA</h3>
            <button class="modal-close"><i class="fas fa-times"></i></button>
        </div>
        <div class="modal-content">
            <div class="teams-grid" id="team-select">
                <!-- Teams will be populated by JS -->
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn-control" id="btn-random-team">
                <i class="fas fa-random"></i> EQUIPA ALEAT√ìRIA
            </button>
            <button class="btn-control btn-secondary" id="btn-view-all-teams">
                <i class="fas fa-eye"></i> VER TODAS
            </button>
        </div>
    </div>

    <!-- Game Details Modal -->
    <div class="modal modal-lg" id="game-details-modal">
        <div class="modal-header">
            <h3><i class="fas fa-basketball-ball"></i> DETALHES DO JOGO</h3>
            <button class="modal-close"><i class="fas fa-times"></i></button>
        </div>
        <div class="modal-content">
            <div class="game-details-content">
                <!-- Game details will be populated by JS -->
            </div>
        </div>
    </div>

    <!-- Player Details Modal -->
    <div class="modal" id="player-details-modal">
        <div class="modal-header">
            <h3><i class="fas fa-user"></i> DETALHES DO JOGADOR</h3>
            <button class="modal-close"><i class="fas fa-times"></i></button>
        </div>
        <div class="modal-content">
            <div class="player-details-content">
                <!-- Player details will be populated by JS -->
            </div>
        </div>
    </div>

    <!-- History Modal -->
    <div class="modal modal-lg" id="history-modal">
        <div class="modal-header">
            <h3><i class="fas fa-history"></i> HIST√ìRICO COMPLETO</h3>
            <button class="modal-close"><i class="fas fa-times"></i></button>
        </div>
        <div class="modal-content">
            <div class="history-content">
                <!-- History will be populated by JS -->
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div class="modal" id="settings-modal">
        <div class="modal-header">
            <h3><i class="fas fa-cog"></i> CONFIGURA√á√ïES</h3>
            <button class="modal-close"><i class="fas fa-times"></i></button>
        </div>
        <div class="modal-content">
            <div class="settings-content">
                <div class="setting-group">
                    <label for="setting-sound">Som:</label>
                    <input type="range" id="setting-sound" min="0" max="100" value="70">
                </div>
                <div class="setting-group">
                    <label for="setting-animations">Anima√ß√µes:</label>
                    <input type="checkbox" id="setting-animations" checked>
                </div>
                <div class="setting-group">
                    <label for="setting-notifications">Notifica√ß√µes:</label>
                    <input type="checkbox" id="setting-notifications" checked>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn-control" id="btn-save-settings">
                <i class="fas fa-save"></i> SALVAR
            </button>
        </div>
    </div>

    <!-- Scripts -->
    <script type="module" src="game.js"></script>
    <script type="module" src="main.js"></script>

    <!-- UI Integration Script (FIX CR√çTICO) -->
    <script>
        // ============================================================
        // CALLBACK GLOBAL OBRIGAT√ìRIO - RECEBE ATUALIZA√á√ïES DO UIMANAGER
        // ============================================================
        console.log('[UI] Carregando sistema de interface...');
        
        // Fun√ß√£o global OBRIGAT√ìRIA que o UIManager usa para enviar atualiza√ß√µes
        window.onUIUpdate = function(payload) {
            console.log('[UI] Recebido payload:', payload.type);
            
            // Processar diferentes tipos de atualiza√ß√£o
            switch(payload.type) {
                case 'LOADING':
                    handleLoading(payload.data);
                    break;
                    
                case 'TEAM_SELECTION':
                    handleTeamSelection(payload.data);
                    break;
                    
                case 'DASHBOARD':
                    handleDashboard(payload.data);
                    break;
                    
                case 'STATUS_UPDATE':
                    handleStatusUpdate(payload.data);
                    break;
                    
                case 'ERROR':
                    handleError(payload.data);
                    break;
                    
                case 'USER_GAME':
                    handleUserGame(payload.data);
                    break;
                    
                case 'HISTORY':
                    handleHistory(payload.data);
                    break;
                    
                default:
                    console.warn('[UI] Tipo de payload desconhecido:', payload.type);
            }
        };

        // ============================================================
        // HANDLERS DE ATUALIZA√á√ÉO DE UI
        // ============================================================

        function handleLoading(data) {
            console.log('[UI] Atualizando loading:', data.percent + '%');
            
            // Atualizar barra de progresso
            const progressFill = document.getElementById('progress-fill');
            const progressText = document.getElementById('loading-progress');
            const subtitle = document.querySelector('.loading-subtitle');
            
            if (progressFill && data.percent !== undefined) {
                progressFill.style.width = `${data.percent}%`;
                progressFill.style.transition = 'width 0.3s ease';
            }
            
            if (progressText && data.message) {
                progressText.textContent = data.message;
            }
            
            if (subtitle && data.debug) {
                subtitle.textContent = data.debug;
            }
            
            // Quando carregamento completar
            if (data.percent >= 100) {
                setTimeout(() => {
                    const loadingScreen = document.getElementById('loading-screen');
                    const app = document.getElementById('app');
                    if (loadingScreen && app) {
                        loadingScreen.classList.add('hidden');
                        app.classList.remove('hidden');
                        console.log('[UI] Loading screen escondida, app mostrada');
                    }
                }, 800);
            }
        }

        function handleTeamSelection(data) {
            console.log('[UI] Mostrando sele√ß√£o de equipas:', data.teams?.length + ' equipas');
            
            // Mostrar modal de sele√ß√£o de equipas
            const modal = document.getElementById('team-selection-modal');
            const overlay = document.getElementById('modal-overlay');
            const teamsGrid = document.getElementById('team-select');
            
            if (teamsGrid && data.teams) {
                teamsGrid.innerHTML = data.teams.map(team => `
                    <div class="team-card" data-team-id="${team.id}">
                        <div class="team-card-header">
                            <div class="team-card-logo">${getMythologyIcon(team.mythology)}</div>
                            <div class="team-card-info">
                                <div class="team-card-name">${team.name}</div>
                                <div class="team-card-mythology">${team.mythology}</div>
                            </div>
                            <div class="team-card-power">${team.teamPower}</div>
                        </div>
                        <div class="team-card-body">
                            <div class="team-card-conference">
                                <i class="fas fa-${team.conference === 'EAST' ? 'sun' : 'moon'}"></i>
                                ${team.conference}
                            </div>
                            <div class="team-card-style">${team.style}</div>
                            <div class="team-card-stats">
                                <small>${team.players?.length || 0} jogadores</small>
                            </div>
                        </div>
                        <button class="btn-control btn-primary select-team-btn" 
                                data-team-id="${team.id}">
                            <i class="fas fa-check"></i> Selecionar
                        </button>
                    </div>
                `).join('');
                
                // Adicionar event listeners aos bot√µes de sele√ß√£o
                document.querySelectorAll('.select-team-btn').forEach(btn => {
                    btn.addEventListener('click', function(e) {
                        const teamId = parseInt(this.dataset.teamId);
                        if (window.uiManager && !isNaN(teamId)) {
                            window.uiManager.handleSelectTeam(teamId);
                            closeModal('team-selection-modal');
                        }
                    });
                });
            }
            
            // Mostrar modal
            if (modal && overlay) {
                modal.classList.add('active');
                overlay.classList.add('active');
                
                // Configurar bot√£o de fechar
                const closeBtn = modal.querySelector('.modal-close');
                if (closeBtn) {
                    closeBtn.onclick = () => closeModal('team-selection-modal');
                }
                
                // Configurar overlay para fechar
                overlay.onclick = () => closeModal('team-selection-modal');
            }
        }

        function handleDashboard(data) {
            console.log('[UI] Atualizando dashboard:', data.userTeam?.name);
            
            // 1. Atualizar equipa do usu√°rio no header
            if (data.userTeam) {
                const teamInfo = document.getElementById('user-team-info');
                if (teamInfo) {
                    teamInfo.innerHTML = `
                        <div class="team-logo-large">${getMythologyIcon(data.userTeam.mythology)}</div>
                        <div class="team-details">
                            <h2 class="team-name">${data.userTeam.name}</h2>
                            <div class="team-stats-row">
                                <span class="team-stat"><i class="fas fa-trophy"></i> REP: ${data.reputation || 50}</span>
                                <span class="team-stat"><i class="fas fa-basketball-ball"></i> PODER: ${data.userTeam.teamPower || 70}</span>
                                <span class="team-stat"><i class="fas fa-chart-line"></i> ${data.userTeam.stats?.wins || 0}-${data.userTeam.stats?.losses || 0}</span>
                                <span class="team-stat"><i class="fas fa-fire"></i> STREAK: ${data.userTeam.stats?.streak || 0}</span>
                            </div>
                        </div>
                    `;
                }
            }
            
            // 2. Atualizar fase e dia
            const phaseElement = document.getElementById('season-phase');
            const dayElement = document.getElementById('day-number');
            
            if (phaseElement) {
                phaseElement.innerHTML = `<span class="phase-badge">${getPhaseLabel(data.phase)}</span>`;
            }
            if (dayElement) {
                dayElement.textContent = `${data.currentDay || 1}/${data.totalDays || 82}`;
            }
            
            // 3. Atualizar classifica√ß√µes
            if (data.standings) {
                updateStandingsUI('EAST', data.standings.EAST || []);
                updateStandingsUI('WEST', data.standings.WEST || []);
            }
            
            // 4. Atualizar pr√≥ximos jogos
            if (data.upcomingGames) {
                updateUpcomingGamesUI(data.upcomingGames);
            }
            
            // 5. Atualizar feed em direto
            if (data.liveFeed) {
                updateLiveFeedUI(data.liveFeed);
            }
            
            // 6. Atualizar ofertas de emprego
            if (data.jobOffers) {
                updateJobOffersUI(data.jobOffers);
            }
            
            // 7. Atualizar jogos em direto
            if (data.liveGames) {
                updateLiveGamesUI(data.liveGames);
            }
        }

        function handleStatusUpdate(data) {
            console.log('[UI] Atualizando status:', data.message?.substring(0, 50));
            addStatusMessageUI(data.message, data.type || 'info');
        }

        function handleError(data) {
            console.error('[UI] Erro recebido:', data.message);
            addStatusMessageUI(`ERRO: ${data.message || 'Desconhecido'}`, 'error');
            
            // Mostrar erro em tela cheia se for cr√≠tico
            if (data.message?.includes('cr√≠tico') || data.message?.includes('fatal')) {
                const loadingScreen = document.getElementById('loading-screen');
                if (loadingScreen) {
                    loadingScreen.innerHTML = `
                        <div style="
                            position: fixed;
                            top: 0; left: 0; right: 0; bottom: 0;
                            background: #0a0a1a;
                            color: white;
                            display: flex;
                            flex-direction: column;
                            align-items: center;
                            justify-content: center;
                            font-family: sans-serif;
                            padding: 20px;
                            text-align: center;
                            z-index: 9999;
                        ">
                            <h1 style="color: #ef476f; margin-bottom: 20px;">‚ùå Erro Cr√≠tico</h1>
                            <pre style="
                                background: rgba(255,255,255,0.1);
                                padding: 20px;
                                border-radius: 8px;
                                max-width: 800px;
                                overflow: auto;
                                text-align: left;
                                color: #ff6b6b;
                            ">${data.message || 'Erro desconhecido'}</pre>
                            <button onclick="location.reload()" style="
                                margin-top: 20px;
                                background: #4a1e8c;
                                color: white;
                                border: none;
                                padding: 12px 24px;
                                border-radius: 8px;
                                font-size: 16px;
                                cursor: pointer;
                            ">Recarregar P√°gina</button>
                        </div>
                    `;
                }
            }
        }

        function handleUserGame(data) {
            console.log('[UI] Iniciando jogo do usu√°rio');
            // Implementar interface de jogo interativo
            showUserGameUI(data.gameData);
        }

        function handleHistory(data) {
            console.log('[UI] Mostrando hist√≥rico:', data.totalGames + ' jogos');
            showHistoryUI(data);
        }

        // ============================================================
        // FUN√á√ïES AUXILIARES DE UI
        // ============================================================

        function updateStandingsUI(conference, teams) {
            const container = document.getElementById(`standings-${conference.toLowerCase()}`);
            if (!container) return;
            
            if (!teams || teams.length === 0) {
                container.innerHTML = '<div class="loading-standings"><p>Sem dados dispon√≠veis</p></div>';
                return;
            }
            
            container.innerHTML = `
                <div class="standings-table">
                    <div class="table-header">
                        <span class="col-rank">#</span>
                        <span class="col-team">Equipa</span>
                        <span class="col-wins">V</span>
                        <span class="col-losses">D</span>
                        <span class="col-pct">%</span>
                        <span class="col-streak">Streak</span>
                    </div>
                    ${teams.map((team, index) => `
                        <div class="table-row ${index < 8 ? 'playoff-spot' : ''}">
                            <span class="col-rank">${team.rank || index + 1}</span>
                            <span class="col-team">
                                ${getMythologyIcon(getTeamMythology(team.id))}
                                ${team.name}
                            </span>
                            <span class="col-wins">${team.wins || 0}</span>
                            <span class="col-losses">${team.losses || 0}</span>
                            <span class="col-pct">${team.winPct || '.000'}</span>
                            <span class="col-streak ${(team.streak || '').startsWith('W') ? 'streak-win' : 'streak-loss'}">
                                ${team.streak || '-'}
                            </span>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function updateUpcomingGamesUI(games) {
            const container = document.getElementById('upcoming-games');
            if (!container) return;
            
            if (!games || games.length === 0) {
                container.innerHTML = `
                    <div class="no-upcoming">
                        <i class="fas fa-calendar-plus"></i>
                        <p>Sem jogos agendados</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = games.slice(0, 3).map(game => {
                const teamInfo = getTeamInfoFromUI(game.opponentId);
                return `
                    <div class="upcoming-game">
                        <div class="game-day">Dia ${game.day}</div>
                        <div class="game-opponent">
                            <div class="opponent-logo">${getMythologyIcon(teamInfo?.mythology)}</div>
                            <div class="opponent-info">
                                <div class="opponent-name">${teamInfo?.name || `Equipa ${game.opponentId}`}</div>
                                <div class="game-location">
                                    <i class="fas fa-${game.isHome ? 'home' : 'plane'}"></i>
                                    ${game.isHome ? 'Casa' : 'Fora'}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function updateLiveFeedUI(feed) {
            const container = document.getElementById('live-feed');
            if (!container) return;
            
            // Mostrar apenas os √∫ltimos 10 eventos
            const recentFeed = Array.isArray(feed) ? feed.slice(-10) : [];
            
            if (recentFeed.length === 0) {
                container.innerHTML = '<div class="feed-entry">Aguardando eventos...</div>';
                return;
            }
            
            container.innerHTML = recentFeed.map(event => `
                <div class="feed-entry">
                    <span class="feed-time">${formatTime(event.timestamp)}</span>
                    <span>${event.text || event.message || 'Evento'}</span>
                </div>
            `).join('');
        }

        function updateJobOffersUI(offers) {
            const section = document.getElementById('job-offers-section');
            const container = document.getElementById('job-offers');
            
            if (!section || !container) return;
            
            if (!offers || offers.length === 0) {
                section.style.display = 'none';
                return;
            }
            
            section.style.display = 'block';
            container.innerHTML = offers.map(offer => `
                <div class="job-offer-card">
                    <div class="offer-header">
                        <div class="offer-team">
                            <div class="team-logo">${getMythologyIcon(getTeamMythology(offer.teamId))}</div>
                            <div class="team-name">${offer.teamName}</div>
                        </div>
                        <div class="offer-conference">${offer.conference}</div>
                    </div>
                    <div class="offer-body">
                        <p class="offer-description">${offer.description || 'Oferta de emprego'}</p>
                        <div class="offer-details">
                            <div class="detail">
                                <i class="fas fa-star"></i>
                                <span>Poder: ${offer.teamPower || 70}</span>
                            </div>
                            <div class="detail">
                                <i class="fas fa-trophy"></i>
                                <span>Rep. m√≠n.: ${offer.reputationRequired || 70}</span>
                            </div>
                        </div>
                    </div>
                    <div class="offer-footer">
                        <button class="btn btn-small reject-offer" onclick="rejectJobOffer()">
                            Recusar
                        </button>
                        <button class="btn btn-small btn-primary accept-offer" 
                                onclick="acceptJobOffer(${offer.teamId})">
                            Aceitar
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function updateLiveGamesUI(liveGames) {
            const container = document.getElementById('recent-games');
            if (!container) return;
            
            const live = liveGames.live || [];
            const completed = liveGames.completed || [];
            
            if (live.length === 0 && completed.length === 0) {
                container.innerHTML = `
                    <div class="no-games">
                        <i class="fas fa-basketball-ball"></i>
                        <p>Aguardando jogos...</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            
            // Jogos em andamento
            live.forEach(game => {
                const homeTeam = getTeamInfoFromUI(game.homeTeamId);
                const awayTeam = getTeamInfoFromUI(game.awayTeamId);
                
                html += `
                    <div class="live-game">
                        <div class="game-teams">
                            <div class="team">
                                <div class="team-logo-small">${getMythologyIcon(homeTeam?.mythology)}</div>
                                <div class="team-name-small">${homeTeam?.name || `Equipa ${game.homeTeamId}`}</div>
                            </div>
                            <div class="vs">VS</div>
                            <div class="team">
                                <div class="team-logo-small">${getMythologyIcon(awayTeam?.mythology)}</div>
                                <div class="team-name-small">${awayTeam?.name || `Equipa ${game.awayTeamId}`}</div>
                            </div>
                        </div>
                        <div class="game-status">
                            <span class="status-live">‚óè EM DIRETO</span>
                        </div>
                    </div>
                `;
            });
            
            // Jogos completados (√∫ltimos 3)
            completed.slice(-3).forEach(game => {
                const homeTeam = getTeamInfoFromUI(game.homeTeamId);
                const awayTeam = getTeamInfoFromUI(game.awayTeamId);
                
                html += `
                    <div class="completed-game">
                        <div class="game-teams">
                            <div class="team">
                                <div class="team-logo-small">${getMythologyIcon(homeTeam?.mythology)}</div>
                                <div class="team-name-small">${homeTeam?.name || `Equipa ${game.homeTeamId}`}</div>
                            </div>
                            <div class="score">
                                ${game.result?.homePoints || 0} - ${game.result?.awayPoints || 0}
                            </div>
                            <div class="team">
                                <div class="team-logo-small">${getMythologyIcon(awayTeam?.mythology)}</div>
                                <div class="team-name-small">${awayTeam?.name || `Equipa ${game.awayTeamId}`}</div>
                            </div>
                        </div>
                        <div class="game-status">
                            <span class="status-completed">‚úì FINAL</span>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        function addStatusMessageUI(message, type = 'info') {
            const consoleElement = document.getElementById('status-text');
            if (!consoleElement) return;
            
            const entry = document.createElement('div');
            entry.className = `console-entry ${type}`;
            entry.innerHTML = `
                <span class="console-time">[${new Date().toLocaleTimeString()}]</span>
                <span>${message}</span>
            `;
            
            // Adicionar no in√≠cio
            consoleElement.insertBefore(entry, consoleElement.firstChild);
            
            // Manter apenas √∫ltimos 5 registros
            const entries = consoleElement.querySelectorAll('.console-entry');
            if (entries.length > 5) {
                consoleElement.removeChild(entries[entries.length - 1]);
            }
        }

        function showUserGameUI(gameData) {
            console.log('[UI] Mostrando interface de jogo');
            // Aqui seria implementada a interface completa do jogo
            alert(`üèÄ Jogo do usu√°rio iniciado!\n${gameData.homeTeam.name} vs ${gameData.awayTeam.name}\n\nClique em OK para simular o jogo automaticamente.`);
            
            // Simular o jogo automaticamente
            if (window.uiManager) {
                window.uiManager.handleSimulateGame(gameData);
            }
        }

        function showHistoryUI(data) {
            const modal = document.getElementById('history-modal');
            const overlay = document.getElementById('modal-overlay');
            const content = document.querySelector('.history-content');
            
            if (!modal || !content) return;
            
            let html = '<h4>Seu Hist√≥rico de Jogos</h4>';
            
            if (!data.userHistory || data.userHistory.length === 0) {
                html += '<p>Nenhum jogo jogado ainda.</p>';
            } else {
                html += `
                    <div class="history-stats">
                        <div class="stat">
                            <span class="stat-value">${data.totalGames || 0}</span>
                            <span class="stat-label">Jogos</span>
                        </div>
                        <div class="stat">
                            <span class="stat-value">${data.wins || 0}</span>
                            <span class="stat-label">Vit√≥rias</span>
                        </div>
                        <div class="stat">
                            <span class="stat-value">${(data.totalGames - data.wins) || 0}</span>
                            <span class="stat-label">Derrotas</span>
                        </div>
                    </div>
                    <div class="history-games">
                `;
                
                data.userHistory.slice(0, 10).forEach(game => {
                    const isWin = (game.homeTeam.id === window.uiManager?.getGameState()?.playerTeamId && game.result.winner === 'home') ||
                                  (game.awayTeam.id === window.uiManager?.getGameState()?.playerTeamId && game.result.winner === 'away');
                    
                    html += `
                        <div class="history-game ${isWin ? 'win' : 'loss'}">
                            <div class="game-date">${game.date}</div>
                            <div class="game-teams">
                                <span class="team-name">${game.homeTeam.name}</span>
                                <span class="score">${game.homeTeam.score} - ${game.awayTeam.score}</span>
                                <span class="team-name">${game.awayTeam.name}</span>
                            </div>
                            <div class="game-result">
                                <span class="result-badge">${isWin ? 'VIT√ìRIA' : 'DERROTA'}</span>
                            </div>
                        </div>
                    `;
                });
                
                html += '</div>';
            }
            
            content.innerHTML = html;
            
            // Mostrar modal
            modal.classList.add('active');
            overlay.classList.add('active');
            
            // Configurar bot√£o de fechar
            const closeBtn = modal.querySelector('.modal-close');
            if (closeBtn) {
                closeBtn.onclick = () => closeModal('history-modal');
            }
            
            // Configurar overlay para fechar
            overlay.onclick = () => closeModal('history-modal');
        }

        // ============================================================
        // UTILIT√ÅRIOS
        // ============================================================

        function getMythologyIcon(mythology) {
            const icons = {
                'Grega': 'üèõÔ∏è', 'Romana': '‚öîÔ∏è', 'N√≥rdica': '‚ö°',
                'Eg√≠pcia': 'üêç', 'Hindu': 'üïâÔ∏è', 'Shinto': '‚õ©Ô∏è',
                'Chinesa': 'üêâ', 'Celta': 'üå≥', 'Yorub√°': 'üåç',
                'Maia': 'üåû', 'Asteca': 'ü¶Ö', 'Mesopot√¢mica': 'üè∫',
                'Inuit': '‚ùÑÔ∏è', 'Eslava': 'üå©Ô∏è', 'Polin√©sia': 'üåä',
                'Abor√≠gene Australiana': 'üé®', 'Judaica Antiga': '‚ú°Ô∏è',
                'Crist√£ (Arcanjos)': 'üòá', 'Isl√¢mica (Anjos)': '‚ò™Ô∏è',
                'Persa': 'üî•'
            };
            return icons[mythology] || 'üëë';
        }

        function getPhaseLabel(phase) {
            const labels = {
                'INIT': 'INICIALIZANDO',
                'TEAM_SELECTION': 'SELECIONE EQUIPA',
                'REGULAR_SEASON': '√âPOCA REGULAR',
                'PLAYOFFS': 'PLAYOFFS',
                'FINALS': 'FINAIS',
                'OFFSEASON': 'FORA DE √âPOCA',
                'FINISHED': 'CONCLU√çDO'
            };
            return labels[phase] || phase;
        }

        function getTeamInfoFromUI(teamId) {
            // Tenta obter informa√ß√µes da equipa atrav√©s do UIManager
            if (window.uiManager && window.uiManager.getGameEngine) {
                try {
                    const engine = window.uiManager.getGameEngine();
                    if (engine && engine.getTeamInfo) {
                        return engine.getTeamInfo(teamId);
                    }
                } catch (e) {
                    console.warn('[UI] Erro ao obter info da equipa:', e);
                }
            }
            return null;
        }

        function getTeamMythology(teamId) {
            const team = getTeamInfoFromUI(teamId);
            return team?.mythology || 'Desconhecida';
        }

        function formatTime(timestamp) {
            if (!timestamp) return '--:--';
            try {
                const date = new Date(timestamp);
                return date.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            } catch {
                return '--:--';
            }
        }

        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            const overlay = document.getElementById('modal-overlay');
            
            if (modal) modal.classList.remove('active');
            if (overlay) overlay.classList.remove('active');
        }

        // ============================================================
        // FUN√á√ïES GLOBAIS PARA INTERA√á√ÉO
        // ============================================================

        window.acceptJobOffer = function(teamId) {
            if (window.uiManager) {
                window.uiManager.handleAcceptJobOffer(teamId);
                document.getElementById('job-offers-section').style.display = 'none';
                addStatusMessageUI('‚úÖ Oferta de emprego aceita!', 'success');
            }
        };

        window.rejectJobOffer = function() {
            document.getElementById('job-offers-section').style.display = 'none';
            addStatusMessageUI('‚ùå Oferta de emprego recusada.', 'info');
        };

        window.selectTeam = function(teamId) {
            if (window.uiManager) {
                window.uiManager.handleSelectTeam(teamId);
            }
        };

        // ============================================================
        // INICIALIZA√á√ÉO DA UI
        // ============================================================

        document.addEventListener('DOMContentLoaded', function() {
            console.log('[UI] DOM carregado, configurando event listeners...');
            
            // Configurar controles de velocidade
            document.querySelectorAll('.speed-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const speed = parseInt(this.dataset.speed);
                    if (window.uiManager && !isNaN(speed)) {
                        window.uiManager.handleSetSpeed(speed);
                        
                        // Atualizar estado visual
                        document.querySelectorAll('.speed-btn').forEach(b => b.classList.remove('active'));
                        this.classList.add('active');
                        
                        addStatusMessageUI(`‚ö° Velocidade alterada para ${speed}x`, 'info');
                    }
                });
            });
            
            // Configurar bot√£o de simular dia
            const btnSimulateDay = document.getElementById('btn-simulate-day');
            if (btnSimulateDay) {
                btnSimulateDay.addEventListener('click', function() {
                    if (window.uiManager) {
                        window.uiManager.handleSimulateDay();
                        addStatusMessageUI('‚è© Simulando pr√≥ximo dia...', 'info');
                    }
                });
            }
            
            // Configurar bot√£o de alternar modo autom√°tico
            const btnAutoToggle = document.getElementById('btn-auto-toggle');
            if (btnAutoToggle) {
                btnAutoToggle.addEventListener('click', function() {
                    if (window.uiManager) {
                        window.uiManager.handleToggleAuto();
                        this.classList.toggle('active');
                        const isAuto = this.classList.contains('active');
                        addStatusMessageUI(
                            isAuto ? 'ü§ñ Modo autom√°tico ATIVADO' : 'üë§ Modo manual ATIVADO',
                            'info'
                        );
                    }
                });
            }
            
            // Configurar bot√£o de sele√ß√£o de equipa
            const btnTeamSelect = document.getElementById('btn-team-select');
            if (btnTeamSelect) {
                btnTeamSelect.addEventListener('click', function() {
                    if (window.uiManager) {
                        const gameState = window.uiManager.getGameState();
                        if (gameState?.phase === 'TEAM_SELECTION') {
                            window.onUIUpdate({
                                type: 'TEAM_SELECTION',
                                data: { teams: gameState.teams }
                            });
                        } else {
                            addStatusMessageUI('‚ö†Ô∏è N√£o est√° na fase de sele√ß√£o de equipas', 'warning');
                        }
                    }
                });
            }
            
            // Configurar bot√£o de hist√≥rico
            const btnViewHistory = document.getElementById('btn-view-history');
            if (btnViewHistory) {
                btnViewHistory.addEventListener('click', function() {
                    if (window.uiManager) {
                        window.uiManager.handleViewHistory();
                    }
                });
            }
            
            // Configurar tabs das confer√™ncias
            document.querySelectorAll('.conf-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const conference = this.dataset.conference;
                    document.querySelectorAll('.conf-tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.standings-conference').forEach(c => c.classList.remove('active'));
                    this.classList.add('active');
                    document.getElementById(`standings-${conference.toLowerCase()}`)?.classList.add('active');
                });
            });
            
            // Configurar bot√£o de mudar equipa
            const btnSwitchTeam = document.getElementById('btn-switch-team');
            if (btnSwitchTeam) {
                btnSwitchTeam.addEventListener('click', function() {
                    if (window.uiManager && confirm('Mudar de equipa reduz reputa√ß√£o. Continuar?')) {
                        const gameState = window.uiManager.getGameState();
                        if (gameState) {
                            gameState.phase = 'TEAM_SELECTION';
                            gameState.playerTeamId = null;
                            window.uiManager.render();
                            addStatusMessageUI('üîÑ Modo de sele√ß√£o de equipas ativado', 'info');
                        }
                    }
                });
            }
            
            console.log('[UI] Event listeners configurados com sucesso');
        });

        // ============================================================
        // SISTEMA DE DIAGN√ìSTICO
        // ============================================================

        window.mbaDiagnoseUI = function() {
            return {
                timestamp: Date.now(),
                onUIUpdate: typeof window.onUIUpdate,
                uiManager: !!window.uiManager,
                elements: {
                    loadingScreen: !!document.getElementById('loading-screen'),
                    app: !!document.getElementById('app'),
                    progressFill: !!document.getElementById('progress-fill'),
                    statusText: !!document.getElementById('status-text'),
                    standingsEast: !!document.getElementById('standings-east'),
                    standingsWest: !!document.getElementById('standings-west'),
                    upcomingGames: !!document.getElementById('upcoming-games'),
                    liveFeed: !!document.getElementById('live-feed')
                }
            };
        };

        console.log('[UI] Sistema de interface carregado e pronto');
    </script>

    <!-- Sistema de diagn√≥stico MBA -->
    <script>
        // Sistema de diagn√≥stico MBA
        (function() {
            console.log('[MBA-DIAG] Sistema de diagn√≥stico inicializado');
            
            // Vari√°veis de diagn√≥stico
            const diagnosis = {
                started: Date.now(),
                events: [],
                errors: [],
                uiUpdates: []
            };
            
            // Registrar eventos importantes
            ['DOMContentLoaded', 'load', 'mba:uimanager-ready', 'mba:ui-update'].forEach(eventName => {
                document.addEventListener(eventName, (e) => {
                    diagnosis.events.push({
                        event: eventName,
                        timestamp: Date.now(),
                        detail: e.detail || 'N/A'
                    });
                    console.log(`[MBA-DIAG] Evento: ${eventName}`, e.detail || '');
                });
            });
            
            // Capturar erros
            window.addEventListener('error', (e) => {
                diagnosis.errors.push({
                    message: e.message,
                    filename: e.filename,
                    lineno: e.lineno,
                    colno: e.colno,
                    timestamp: Date.now()
                });
            });
            
            // Fun√ß√£o global para diagn√≥stico
            window.mbaGetDiagnosis = function() {
                return {
                    ...diagnosis,
                    duration: Date.now() - diagnosis.started,
                    dom: {
                        loadingScreen: !!document.getElementById('loading-screen'),
                        app: !!document.getElementById('app'),
                        progressFill: !!document.getElementById('progress-fill')
                    },
                    window: {
                        uiManager: !!window.uiManager,
                        onUIUpdate: typeof window.onUIUpdate,
                        gameEngine: !!window.gameEngine,
                        mbaDiagnoseUI: typeof window.mbaDiagnoseUI
                    }
                };
            };
            
            // Exibir diagn√≥stico no console ap√≥s 3 segundos
            setTimeout(() => {
                console.log('[MBA-DIAG] Diagn√≥stico autom√°tico (3s):', window.mbaGetDiagnosis());
            }, 3000);
            
            console.log('[MBA-DIAG] Sistema pronto');
        })();
    </script>
</body>
</html>